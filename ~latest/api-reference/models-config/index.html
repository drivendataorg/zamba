
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Zamba is a command-line tool built in Python to automatically identify the species seen in camera trap videos from sites in central Africa.">
      
      
      
        <link rel="canonical" href="https://zamba.drivendata.org/docs/~latest/api-reference/models-config/">
      
      
        <link rel="prev" href="../data-video/">
      
      
        <link rel="next" href="../depth_config/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.38">
    
    
      
        <title>zamba.models.config - Zamba</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.8c3ca2c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
      <link rel="stylesheet" href="../../stylesheets/custom_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#zambamodelsconfig" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Zamba" class="md-header__button md-logo" aria-label="Zamba" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Zamba
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              zamba.models.config
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/drivendataorg/zamba" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Zamba" class="md-nav__button md-logo" aria-label="Zamba" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Zamba
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/drivendataorg/zamba" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Getting started
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Getting started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../install/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installing zamba
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Quickstart
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  <span class="md-ellipsis">
    User Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            User Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../predict-tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Classifying unlabeled videos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../train-tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Training a model on labeled videos
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../debugging/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Debugging
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../extra-options/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Guide to common optional parameters
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Available Models
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Available Models
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../models/species-detection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Species detection
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../models/depth/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Depth estimation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../models/densepose/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    DensePose
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../models/td-full-metrics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    African species performance
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Advanced Options
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Advanced Options
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../configurations/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    All configuration options
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../yaml-config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using YAML configuration files
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../contribute/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Contribute to zamba
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Contribute to zamba
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../changelog/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Changelog
  </span>
  

            </a>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Changelog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" checked>
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_1" >
        
          
          <label class="md-nav__link" for="__nav_8_1" id="__nav_8_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    zamba.data
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_1">
            <span class="md-nav__icon md-icon"></span>
            zamba.data
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data-metadata/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    zamba.data.metadata
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../data-video/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    zamba.data.video
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_2" checked>
        
          
          <label class="md-nav__link" for="__nav_8_2" id="__nav_8_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    zamba.models
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_8_2">
            <span class="md-nav__icon md-icon"></span>
            zamba.models
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    zamba.models.config
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    zamba.models.config
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#zamba.models.config" class="md-nav__link">
    <span class="md-ellipsis">
      config
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamba.models.config.BackboneFinetuneConfig" class="md-nav__link">
    <span class="md-ellipsis">
      BackboneFinetuneConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamba.models.config.EarlyStoppingConfig" class="md-nav__link">
    <span class="md-ellipsis">
      EarlyStoppingConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamba.models.config.ModelConfig" class="md-nav__link">
    <span class="md-ellipsis">
      ModelConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamba.models.config.ModelEnum" class="md-nav__link">
    <span class="md-ellipsis">
      ModelEnum
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamba.models.config.MonitorEnum" class="md-nav__link">
    <span class="md-ellipsis">
      MonitorEnum
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamba.models.config.PredictConfig" class="md-nav__link">
    <span class="md-ellipsis">
      PredictConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamba.models.config.SchedulerConfig" class="md-nav__link">
    <span class="md-ellipsis">
      SchedulerConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamba.models.config.TrainConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TrainConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamba.models.config.ZambaBaseModel" class="md-nav__link">
    <span class="md-ellipsis">
      ZambaBaseModel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamba.models.config.check_files_exist_and_load" class="md-nav__link">
    <span class="md-ellipsis">
      check_files_exist_and_load
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamba.models.config.get_filepaths" class="md-nav__link">
    <span class="md-ellipsis">
      get_filepaths
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamba.models.config.make_split" class="md-nav__link">
    <span class="md-ellipsis">
      make_split
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamba.models.config.validate_gpus" class="md-nav__link">
    <span class="md-ellipsis">
      validate_gpus
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamba.models.config.validate_model_cache_dir" class="md-nav__link">
    <span class="md-ellipsis">
      validate_model_cache_dir
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamba.models.config.validate_model_name_and_checkpoint" class="md-nav__link">
    <span class="md-ellipsis">
      validate_model_name_and_checkpoint
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_2_2" >
        
          
          <label class="md-nav__link" for="__nav_8_2_2" id="__nav_8_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    zamba.model.depth_estimation
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_8_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_2">
            <span class="md-nav__icon md-icon"></span>
            zamba.model.depth_estimation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../depth_config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    zamba.models.depth_estimation.config
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../depth_manager/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    zamba.models.depth_estimation.depth_manager
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_2_3" >
        
          
          <label class="md-nav__link" for="__nav_8_2_3" id="__nav_8_2_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    zamba.models.densepose
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_8_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_2_3">
            <span class="md-nav__icon md-icon"></span>
            zamba.models.densepose
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../densepose_config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    zamba.models.densepose.config
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../densepose_manager/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    zamba.models.densepose.densepose_manager
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../models-efficientnet_models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    zamba.models.efficientnet_models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../models-model_manager/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    zamba.models.model_manager
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../models-slowfast_models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    zamba.models.slowfast_models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../models-utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    zamba.models.utils
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_3" >
        
          
          <label class="md-nav__link" for="__nav_8_3" id="__nav_8_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    zamba.object_detection
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_3">
            <span class="md-nav__icon md-icon"></span>
            zamba.object_detection
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../object-detection-megadetector_lite_yolox/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    zamba.object_detection.yolox.megadetector_lite_yolox
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_4" >
        
          
          <label class="md-nav__link" for="__nav_8_4" id="__nav_8_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    zamba.pytorch
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_4">
            <span class="md-nav__icon md-icon"></span>
            zamba.pytorch
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pytorch-dataloaders/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    zamba.pytorch.dataloaders
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pytorch-finetuning/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    zamba.pytorch.finetuning
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pytorch-layers/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    zamba.pytorch.layers
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pytorch-transforms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    zamba.pytorch.transforms
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pytorch-utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    zamba.pytorch.utils
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8_5" >
        
          
          <label class="md-nav__link" for="__nav_8_5" id="__nav_8_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    zamba.pytorch_lightning
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_8_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8_5">
            <span class="md-nav__icon md-icon"></span>
            zamba.pytorch_lightning
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pytorch_lightning-utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    zamba.pytorch_lightning.utils
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../exceptions/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    zamba.exceptions
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../metrics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    zamba.metrics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../settings/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    zamba.settings
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#zamba.models.config" class="md-nav__link">
    <span class="md-ellipsis">
      config
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamba.models.config.BackboneFinetuneConfig" class="md-nav__link">
    <span class="md-ellipsis">
      BackboneFinetuneConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamba.models.config.EarlyStoppingConfig" class="md-nav__link">
    <span class="md-ellipsis">
      EarlyStoppingConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamba.models.config.ModelConfig" class="md-nav__link">
    <span class="md-ellipsis">
      ModelConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamba.models.config.ModelEnum" class="md-nav__link">
    <span class="md-ellipsis">
      ModelEnum
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamba.models.config.MonitorEnum" class="md-nav__link">
    <span class="md-ellipsis">
      MonitorEnum
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamba.models.config.PredictConfig" class="md-nav__link">
    <span class="md-ellipsis">
      PredictConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamba.models.config.SchedulerConfig" class="md-nav__link">
    <span class="md-ellipsis">
      SchedulerConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamba.models.config.TrainConfig" class="md-nav__link">
    <span class="md-ellipsis">
      TrainConfig
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamba.models.config.ZambaBaseModel" class="md-nav__link">
    <span class="md-ellipsis">
      ZambaBaseModel
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamba.models.config.check_files_exist_and_load" class="md-nav__link">
    <span class="md-ellipsis">
      check_files_exist_and_load
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamba.models.config.get_filepaths" class="md-nav__link">
    <span class="md-ellipsis">
      get_filepaths
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamba.models.config.make_split" class="md-nav__link">
    <span class="md-ellipsis">
      make_split
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamba.models.config.validate_gpus" class="md-nav__link">
    <span class="md-ellipsis">
      validate_gpus
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamba.models.config.validate_model_cache_dir" class="md-nav__link">
    <span class="md-ellipsis">
      validate_model_cache_dir
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#zamba.models.config.validate_model_name_and_checkpoint" class="md-nav__link">
    <span class="md-ellipsis">
      validate_model_name_and_checkpoint
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="zambamodelsconfig">zamba.models.config<a class="headerlink" href="#zambamodelsconfig" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">



<a id="zamba.models.config"></a>
    <div class="doc doc-contents first">



  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="zamba.models.config.BackboneFinetuneConfig" class="doc doc-heading">
            <code>BackboneFinetuneConfig</code>


<a href="#zamba.models.config.BackboneFinetuneConfig" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="zamba.models.config.ZambaBaseModel" href="#zamba.models.config.ZambaBaseModel">ZambaBaseModel</a></code></p>


        <p>Configuration containing parameters to be used for backbone finetuning.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>unfreeze_backbone_at_epoch</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Epoch at which the backbone
will be unfrozen. Defaults to 5.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>backbone_initial_ratio_lr</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Used to scale down the backbone
learning rate compared to rest of model. Defaults to 0.01.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>multiplier</code></td>
            <td>
                  <code>int or float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Multiply the learning rate by a constant
value at the end of each epoch. Defaults to 1.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>pre_train_bn</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Train batch normalization layers prior to
finetuning. False is recommended for slowfast models and True is recommended
for time distributed models. Defaults to False.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>train_bn</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Make batch normalization trainable. Defaults to False.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>verbose</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Display current learning rate for model and backbone.
Defaults to True.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>zamba/models/config.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">BackboneFinetuneConfig</span><span class="p">(</span><span class="n">ZambaBaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configuration containing parameters to be used for backbone finetuning.</span>

<span class="sd">    Args:</span>
<span class="sd">        unfreeze_backbone_at_epoch (int, optional): Epoch at which the backbone</span>
<span class="sd">            will be unfrozen. Defaults to 5.</span>
<span class="sd">        backbone_initial_ratio_lr (float, optional): Used to scale down the backbone</span>
<span class="sd">            learning rate compared to rest of model. Defaults to 0.01.</span>
<span class="sd">        multiplier (int or float, optional): Multiply the learning rate by a constant</span>
<span class="sd">            value at the end of each epoch. Defaults to 1.</span>
<span class="sd">        pre_train_bn (bool, optional): Train batch normalization layers prior to</span>
<span class="sd">            finetuning. False is recommended for slowfast models and True is recommended</span>
<span class="sd">            for time distributed models. Defaults to False.</span>
<span class="sd">        train_bn (bool, optional): Make batch normalization trainable. Defaults to False.</span>
<span class="sd">        verbose (bool, optional): Display current learning rate for model and backbone.</span>
<span class="sd">            Defaults to True.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">unfreeze_backbone_at_epoch</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">backbone_initial_ratio_lr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.01</span>
    <span class="n">multiplier</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">pre_train_bn</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># freeze batch norm layers prior to finetuning</span>
    <span class="n">train_bn</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># don&#39;t train bn layers in unfrozen finetuning layers</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="zamba.models.config.EarlyStoppingConfig" class="doc doc-heading">
            <code>EarlyStoppingConfig</code>


<a href="#zamba.models.config.EarlyStoppingConfig" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="zamba.models.config.ZambaBaseModel" href="#zamba.models.config.ZambaBaseModel">ZambaBaseModel</a></code></p>


        <p>Configuration containing parameters to be used for early stopping.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>monitor</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Metric to be monitored. Options are "val_macro_f1" or
"val_loss". Defaults to "val_macro_f1".</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>patience</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of epochs with no improvement after which training
will be stopped. Defaults to 5.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>verbose</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Verbosity mode. Defaults to True.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>mode</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Options are "min" or "max". In "min" mode, training
will stop when the quantity monitored has stopped decreasing and in
"max" mode it will stop when the quantity monitored has stopped increasing.
If None, mode will be inferred from monitor. Defaults to None.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>zamba/models/config.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">EarlyStoppingConfig</span><span class="p">(</span><span class="n">ZambaBaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configuration containing parameters to be used for early stopping.</span>

<span class="sd">    Args:</span>
<span class="sd">        monitor (str): Metric to be monitored. Options are &quot;val_macro_f1&quot; or</span>
<span class="sd">            &quot;val_loss&quot;. Defaults to &quot;val_macro_f1&quot;.</span>
<span class="sd">        patience (int): Number of epochs with no improvement after which training</span>
<span class="sd">            will be stopped. Defaults to 5.</span>
<span class="sd">        verbose (bool): Verbosity mode. Defaults to True.</span>
<span class="sd">        mode (str, optional): Options are &quot;min&quot; or &quot;max&quot;. In &quot;min&quot; mode, training</span>
<span class="sd">            will stop when the quantity monitored has stopped decreasing and in</span>
<span class="sd">            &quot;max&quot; mode it will stop when the quantity monitored has stopped increasing.</span>
<span class="sd">            If None, mode will be inferred from monitor. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">monitor</span><span class="p">:</span> <span class="n">MonitorEnum</span> <span class="o">=</span> <span class="s2">&quot;val_macro_f1&quot;</span>
    <span class="n">patience</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">mode</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@root_validator</span>
    <span class="k">def</span> <span class="nf">validate_mode</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;val_macro_f1&quot;</span><span class="p">:</span> <span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="s2">&quot;val_loss&quot;</span><span class="p">:</span> <span class="s2">&quot;min&quot;</span><span class="p">}[</span><span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;monitor&quot;</span><span class="p">)]</span>
        <span class="n">user_mode</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;mode&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">user_mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;mode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mode</span>
        <span class="k">elif</span> <span class="n">user_mode</span> <span class="o">!=</span> <span class="n">mode</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Provided mode </span><span class="si">{</span><span class="n">user_mode</span><span class="si">}</span><span class="s2"> is incorrect for </span><span class="si">{</span><span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;monitor&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> monitor.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">values</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="zamba.models.config.ModelConfig" class="doc doc-heading">
            <code>ModelConfig</code>


<a href="#zamba.models.config.ModelConfig" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="zamba.models.config.ZambaBaseModel" href="#zamba.models.config.ZambaBaseModel">ZambaBaseModel</a></code></p>


        <p>Contains all configs necessary to use a model for training or inference.
Must contain a train_config or a predict_config at a minimum.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>video_loader_config</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="zamba.data.video.VideoLoaderConfig" href="../data-video/#zamba.data.video.VideoLoaderConfig">VideoLoaderConfig</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An instantiated VideoLoaderConfig.
If None, will use default video loader config for model specified in TrainConfig or
PredictConfig.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>train_config</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="zamba.models.config.TrainConfig" href="#zamba.models.config.TrainConfig">TrainConfig</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An instantiated TrainConfig.
Defaults to None.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>predict_config</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="zamba.models.config.PredictConfig" href="#zamba.models.config.PredictConfig">PredictConfig</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An instantiated PredictConfig.
Defaults to None.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>zamba/models/config.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ModelConfig</span><span class="p">(</span><span class="n">ZambaBaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Contains all configs necessary to use a model for training or inference.</span>
<span class="sd">    Must contain a train_config or a predict_config at a minimum.</span>

<span class="sd">    Args:</span>
<span class="sd">        video_loader_config (VideoLoaderConfig, optional): An instantiated VideoLoaderConfig.</span>
<span class="sd">            If None, will use default video loader config for model specified in TrainConfig or</span>
<span class="sd">            PredictConfig.</span>
<span class="sd">        train_config (TrainConfig, optional): An instantiated TrainConfig.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">        predict_config (PredictConfig, optional): An instantiated PredictConfig.</span>
<span class="sd">            Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">video_loader_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">VideoLoaderConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">train_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">TrainConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">predict_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PredictConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
        <span class="n">json_loads</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span>

    <span class="nd">@root_validator</span><span class="p">(</span><span class="n">skip_on_failure</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">one_config_must_exist</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;train_config&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;predict_config&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must provide either `train_config` or `predict_config`.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">values</span>

    <span class="nd">@root_validator</span><span class="p">(</span><span class="n">skip_on_failure</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">get_default_video_loader_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;video_loader_config&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">model_name</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">values</span><span class="p">[</span><span class="s2">&quot;train_config&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">model_name</span>
                <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;train_config&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;predict_config&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">model_name</span>
            <span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No video loader config specified. Using default for </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

            <span class="n">config_file</span> <span class="o">=</span> <span class="n">MODELS_DIRECTORY</span> <span class="o">/</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">/config.yaml&quot;</span>
            <span class="k">with</span> <span class="n">config_file</span><span class="o">.</span><span class="n">open</span><span class="p">()</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">config_dict</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;video_loader_config&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">VideoLoaderConfig</span><span class="p">(</span><span class="o">**</span><span class="n">config_dict</span><span class="p">[</span><span class="s2">&quot;video_loader_config&quot;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">values</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="zamba.models.config.ModelEnum" class="doc doc-heading">
            <code>ModelEnum</code>


<a href="#zamba.models.config.ModelEnum" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>str</code>, <code><span title="enum.Enum">Enum</span></code></p>


        <p>Shorthand names of models supported by zamba.</p>

              <details class="quote">
                <summary>Source code in <code>zamba/models/config.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ModelEnum</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Shorthand names of models supported by zamba.&quot;&quot;&quot;</span>

    <span class="n">time_distributed</span> <span class="o">=</span> <span class="s2">&quot;time_distributed&quot;</span>
    <span class="n">slowfast</span> <span class="o">=</span> <span class="s2">&quot;slowfast&quot;</span>
    <span class="n">european</span> <span class="o">=</span> <span class="s2">&quot;european&quot;</span>
    <span class="n">blank_nonblank</span> <span class="o">=</span> <span class="s2">&quot;blank_nonblank&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="zamba.models.config.MonitorEnum" class="doc doc-heading">
            <code>MonitorEnum</code>


<a href="#zamba.models.config.MonitorEnum" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code>str</code>, <code><span title="enum.Enum">Enum</span></code></p>


        <p>Validation metric to monitor for early stopping. Training is stopped when no
improvement is observed.</p>

              <details class="quote">
                <summary>Source code in <code>zamba/models/config.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">MonitorEnum</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validation metric to monitor for early stopping. Training is stopped when no</span>
<span class="sd">    improvement is observed.&quot;&quot;&quot;</span>

    <span class="n">val_macro_f1</span> <span class="o">=</span> <span class="s2">&quot;val_macro_f1&quot;</span>
    <span class="n">val_loss</span> <span class="o">=</span> <span class="s2">&quot;val_loss&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="zamba.models.config.PredictConfig" class="doc doc-heading">
            <code>PredictConfig</code>


<a href="#zamba.models.config.PredictConfig" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="zamba.models.config.ZambaBaseModel" href="#zamba.models.config.ZambaBaseModel">ZambaBaseModel</a></code></p>


        <p>Configuration for using a model for inference.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>filepaths</code></td>
            <td>
                  <code><span title="pydantic.FilePath">FilePath</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to a CSV containing videos for inference, with
one row per video in the data_dir. There must be a column called
'filepath' (absolute or relative to the data_dir). If None, uses
all files in data_dir. Defaults to None.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>data_dir</code></td>
            <td>
                  <code><span title="pydantic.DirectoryPath">DirectoryPath</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to a directory containing videos for
inference. Defaults to the working directory.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>model_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the model to use for inference. Options are:
time_distributed, slowfast, european, blank_nonblank. Defaults to time_distributed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>checkpoint</code></td>
            <td>
                  <code><span title="pydantic.FilePath">FilePath</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to a custom checkpoint file (.ckpt)
generated by zamba that can be used to generate predictions. If None,
defaults to a pretrained model. Defaults to None.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>gpus</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of GPUs to use for inference.
Defaults to all of the available GPUs found on the machine.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>num_workers</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of subprocesses to use for data loading. 0 means
that the data will be loaded in the main process. The maximum value is
the number of CPUs in the system. Defaults to 3.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>batch_size</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Batch size to use for inference. Defaults to 2.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>save</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to save out predictions. If False, predictions are
not saved. Defaults to True.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>save_dir</code></td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An optional directory in which to save the model
 predictions and configuration yaml. If no save_dir is specified and save=True,
 outputs will be written to the current working directory. Defaults to None.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>overwrite</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, overwrite outputs in save_dir if they exist.
Defaults to False.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>dry_run</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Perform inference on a single batch for testing. Predictions
will not be saved. Defaults to False.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>proba_threshold</code></td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Probability threshold for classification.
If specified, binary predictions are returned with 1 being greater than the
threshold and 0 being less than or equal to the threshold. If None, return
probability scores for each species. Defaults to None.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>output_class_names</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Output the species with the highest probability
score as a single prediction for each video. If False, return probabilty
scores for each species. Defaults to False.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>weight_download_region</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>s3 region to download pretrained weights from.
Options are "us" (United States), "eu" (Europe), or "asia" (Asia Pacific).
Defaults to "us".</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>skip_load_validation</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>By default, zamba runs a check to verify that
all videos can be loaded and skips files that cannot be loaded. This can
be time intensive, depending on how many videos there are. If you are very
confident all your videos can be loaded, you can set this to True and skip
this check. Defaults to False.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>model_cache_dir</code></td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cache directory where downloaded model weights
will be saved. If None and no environment variable is set, will use your
default cache directory. Defaults to None.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>zamba/models/config.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PredictConfig</span><span class="p">(</span><span class="n">ZambaBaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Configuration for using a model for inference.</span>

<span class="sd">    Args:</span>
<span class="sd">        filepaths (FilePath): Path to a CSV containing videos for inference, with</span>
<span class="sd">            one row per video in the data_dir. There must be a column called</span>
<span class="sd">            &#39;filepath&#39; (absolute or relative to the data_dir). If None, uses</span>
<span class="sd">            all files in data_dir. Defaults to None.</span>
<span class="sd">        data_dir (DirectoryPath): Path to a directory containing videos for</span>
<span class="sd">            inference. Defaults to the working directory.</span>
<span class="sd">        model_name (str, optional): Name of the model to use for inference. Options are:</span>
<span class="sd">            time_distributed, slowfast, european, blank_nonblank. Defaults to time_distributed.</span>
<span class="sd">        checkpoint (FilePath, optional): Path to a custom checkpoint file (.ckpt)</span>
<span class="sd">            generated by zamba that can be used to generate predictions. If None,</span>
<span class="sd">            defaults to a pretrained model. Defaults to None.</span>
<span class="sd">        gpus (int): Number of GPUs to use for inference.</span>
<span class="sd">            Defaults to all of the available GPUs found on the machine.</span>
<span class="sd">        num_workers (int): Number of subprocesses to use for data loading. 0 means</span>
<span class="sd">            that the data will be loaded in the main process. The maximum value is</span>
<span class="sd">            the number of CPUs in the system. Defaults to 3.</span>
<span class="sd">        batch_size (int): Batch size to use for inference. Defaults to 2.</span>
<span class="sd">        save (bool): Whether to save out predictions. If False, predictions are</span>
<span class="sd">            not saved. Defaults to True.</span>
<span class="sd">        save_dir (Path, optional): An optional directory in which to save the model</span>
<span class="sd">             predictions and configuration yaml. If no save_dir is specified and save=True,</span>
<span class="sd">             outputs will be written to the current working directory. Defaults to None.</span>
<span class="sd">        overwrite (bool): If True, overwrite outputs in save_dir if they exist.</span>
<span class="sd">            Defaults to False.</span>
<span class="sd">        dry_run (bool): Perform inference on a single batch for testing. Predictions</span>
<span class="sd">            will not be saved. Defaults to False.</span>
<span class="sd">        proba_threshold (float, optional): Probability threshold for classification.</span>
<span class="sd">            If specified, binary predictions are returned with 1 being greater than the</span>
<span class="sd">            threshold and 0 being less than or equal to the threshold. If None, return</span>
<span class="sd">            probability scores for each species. Defaults to None.</span>
<span class="sd">        output_class_names (bool): Output the species with the highest probability</span>
<span class="sd">            score as a single prediction for each video. If False, return probabilty</span>
<span class="sd">            scores for each species. Defaults to False.</span>
<span class="sd">        weight_download_region (str): s3 region to download pretrained weights from.</span>
<span class="sd">            Options are &quot;us&quot; (United States), &quot;eu&quot; (Europe), or &quot;asia&quot; (Asia Pacific).</span>
<span class="sd">            Defaults to &quot;us&quot;.</span>
<span class="sd">        skip_load_validation (bool): By default, zamba runs a check to verify that</span>
<span class="sd">            all videos can be loaded and skips files that cannot be loaded. This can</span>
<span class="sd">            be time intensive, depending on how many videos there are. If you are very</span>
<span class="sd">            confident all your videos can be loaded, you can set this to True and skip</span>
<span class="sd">            this check. Defaults to False.</span>
<span class="sd">        model_cache_dir (Path, optional): Cache directory where downloaded model weights</span>
<span class="sd">            will be saved. If None and no environment variable is set, will use your</span>
<span class="sd">            default cache directory. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">data_dir</span><span class="p">:</span> <span class="n">DirectoryPath</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">filepaths</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FilePath</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">checkpoint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FilePath</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">model_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ModelEnum</span><span class="p">]</span> <span class="o">=</span> <span class="n">ModelEnum</span><span class="o">.</span><span class="n">time_distributed</span><span class="o">.</span><span class="n">value</span>
    <span class="n">gpus</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">GPUS_AVAILABLE</span>
    <span class="n">num_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">save_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">dry_run</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">proba_threshold</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">output_class_names</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">weight_download_region</span><span class="p">:</span> <span class="n">RegionEnum</span> <span class="o">=</span> <span class="s2">&quot;us&quot;</span>
    <span class="n">skip_load_validation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">model_cache_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">_validate_gpus</span> <span class="o">=</span> <span class="n">validator</span><span class="p">(</span><span class="s2">&quot;gpus&quot;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">validate_gpus</span><span class="p">)</span>

    <span class="n">_validate_model_cache_dir</span> <span class="o">=</span> <span class="n">validator</span><span class="p">(</span><span class="s2">&quot;model_cache_dir&quot;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span>
        <span class="n">validate_model_cache_dir</span>
    <span class="p">)</span>

    <span class="nd">@root_validator</span><span class="p">(</span><span class="n">skip_on_failure</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">validate_dry_run_and_save</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;dry_run&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;save&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;save_dir&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Cannot save when predicting with dry_run=True. Setting save=False and save_dir=None.&quot;</span>
            <span class="p">)</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;save&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;save_dir&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">values</span>

    <span class="nd">@root_validator</span><span class="p">(</span><span class="n">skip_on_failure</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">validate_save_dir</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="n">save_dir</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;save_dir&quot;</span><span class="p">]</span>
        <span class="n">save</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;save&quot;</span><span class="p">]</span>

        <span class="c1"># if no save_dir but save is True, use current working directory</span>
        <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">save</span><span class="p">:</span>
            <span class="n">save_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">save_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># check if files exist</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="p">(</span><span class="n">save_dir</span> <span class="o">/</span> <span class="s2">&quot;zamba_predictions.csv&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
                <span class="ow">or</span> <span class="p">(</span><span class="n">save_dir</span> <span class="o">/</span> <span class="s2">&quot;predict_configuration.yaml&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>
            <span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;overwrite&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;zamba_predictions.csv and/or predict_configuration.yaml already exist in </span><span class="si">{</span><span class="n">save_dir</span><span class="si">}</span><span class="s2">. If you would like to overwrite, set overwrite=True&quot;</span>
                <span class="p">)</span>

            <span class="c1"># make a directory if needed</span>
            <span class="n">save_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># set save to True if save_dir is set</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">save</span><span class="p">:</span>
                <span class="n">save</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">values</span><span class="p">[</span><span class="s2">&quot;save_dir&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">save_dir</span>
        <span class="n">values</span><span class="p">[</span><span class="s2">&quot;save&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">save</span>

        <span class="k">return</span> <span class="n">values</span>

    <span class="n">_validate_model_name_and_checkpoint</span> <span class="o">=</span> <span class="n">root_validator</span><span class="p">(</span><span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skip_on_failure</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span>
        <span class="n">validate_model_name_and_checkpoint</span>
    <span class="p">)</span>

    <span class="nd">@root_validator</span><span class="p">(</span><span class="n">skip_on_failure</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">validate_proba_threshold</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;proba_threshold&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;proba_threshold&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;proba_threshold&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Setting proba_threshold outside of the range (0, 1) will cause all probabilities to be rounded to the same value.&quot;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;output_class_names&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;`output_class_names` will be ignored because `proba_threshold` is specified.&quot;</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">values</span>

    <span class="n">_get_filepaths</span> <span class="o">=</span> <span class="n">root_validator</span><span class="p">(</span><span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">skip_on_failure</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span>
        <span class="n">get_filepaths</span>
    <span class="p">)</span>

    <span class="nd">@root_validator</span><span class="p">(</span><span class="n">skip_on_failure</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">validate_files</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="c1"># if globbing from data directory, already have valid dataframe</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;filepaths&quot;</span><span class="p">],</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
            <span class="n">files_df</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;filepaths&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># make into dataframe even if only one column for clearer indexing</span>
            <span class="n">files_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;filepaths&quot;</span><span class="p">]))</span>

        <span class="k">if</span> <span class="s2">&quot;filepath&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">files_df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;filepaths&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> must contain a `filepath` column.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">files_df</span> <span class="o">=</span> <span class="n">files_df</span><span class="p">[[</span><span class="s2">&quot;filepath&quot;</span><span class="p">]]</span>

        <span class="c1"># can only contain one row per filepath</span>
        <span class="n">duplicated</span> <span class="o">=</span> <span class="n">files_df</span><span class="o">.</span><span class="n">filepath</span><span class="o">.</span><span class="n">duplicated</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">duplicated</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="n">duplicated</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> duplicate row(s) in filepaths csv. Dropping duplicates so predictions will have one row per video.&quot;</span>
            <span class="p">)</span>
            <span class="n">files_df</span> <span class="o">=</span> <span class="n">files_df</span><span class="p">[[</span><span class="s2">&quot;filepath&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>

        <span class="n">values</span><span class="p">[</span><span class="s2">&quot;filepaths&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">check_files_exist_and_load</span><span class="p">(</span>
            <span class="n">df</span><span class="o">=</span><span class="n">files_df</span><span class="p">,</span>
            <span class="n">data_dir</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;data_dir&quot;</span><span class="p">],</span>
            <span class="n">skip_load_validation</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;skip_load_validation&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">values</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="zamba.models.config.SchedulerConfig" class="doc doc-heading">
            <code>SchedulerConfig</code>


<a href="#zamba.models.config.SchedulerConfig" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="zamba.models.config.ZambaBaseModel" href="#zamba.models.config.ZambaBaseModel">ZambaBaseModel</a></code></p>


        <p>Configuration containing parameters for a custom pytorch learning rate scheduler.
See https://pytorch.org/docs/stable/optim.html for options.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>scheduler</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of learning rate scheduler to use. See
https://pytorch.org/docs/stable/optim.html for options.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>scheduler_params</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameters passed to learning rate
scheduler upon initialization (eg. {"milestones": [1], "gamma": 0.5,
"verbose": True}). Defaults to None.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>zamba/models/config.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">SchedulerConfig</span><span class="p">(</span><span class="n">ZambaBaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configuration containing parameters for a custom pytorch learning rate scheduler.</span>
<span class="sd">    See https://pytorch.org/docs/stable/optim.html for options.</span>

<span class="sd">    Args:</span>
<span class="sd">        scheduler (str): Name of learning rate scheduler to use. See</span>
<span class="sd">            https://pytorch.org/docs/stable/optim.html for options.</span>
<span class="sd">        scheduler_params (dict, optional): Parameters passed to learning rate</span>
<span class="sd">            scheduler upon initialization (eg. {&quot;milestones&quot;: [1], &quot;gamma&quot;: 0.5,</span>
<span class="sd">            &quot;verbose&quot;: True}). Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">scheduler</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">scheduler_params</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;scheduler&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">validate_scheduler</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">scheduler</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">scheduler</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">elif</span> <span class="n">scheduler</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">lr_scheduler</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Scheduler is not a `torch.optim.lr_scheduler`. &quot;</span>
                <span class="s2">&quot;See https://github.com/pytorch/pytorch/blob/master/torch/optim/lr_scheduler.py &quot;</span>
                <span class="s2">&quot;for options.&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">scheduler</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="zamba.models.config.TrainConfig" class="doc doc-heading">
            <code>TrainConfig</code>


<a href="#zamba.models.config.TrainConfig" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="zamba.models.config.ZambaBaseModel" href="#zamba.models.config.ZambaBaseModel">ZambaBaseModel</a></code></p>


        <p>Configuration for training a model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>labels</code></td>
            <td>
                  <code>FilePath or pandas DataFrame</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to a CSV or pandas DataFrame
containing labels for training, with one row per label. There must be
columns called 'filepath' (absolute or relative to the data_dir) and
'label', and optionally columns called 'split' ("train", "val", or "holdout")
and 'site'. Labels must be specified to train a model.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>data_dir</code></td>
            <td>
                  <code><span title="pydantic.DirectoryPath">DirectoryPath</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to a directory containing training
videos. Defaults to the working directory.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>model_name</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the model to use for training. Options are:
time_distributed, slowfast, european, blank_nonblank. Defaults to time_distributed.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>checkpoint</code></td>
            <td>
                  <code><span title="pydantic.FilePath">FilePath</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to a custom checkpoint file (.ckpt)
generated by zamba that can be used to resume training. If None, defaults
to a pretrained model. Defaults to None.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>scheduler_config</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="zamba.models.config.SchedulerConfig" href="#zamba.models.config.SchedulerConfig">SchedulerConfig</a> or str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Config for setting up
the learning rate scheduler on the model. If "default", uses scheduler
that was used for training. If None, will not use a scheduler.
Defaults to "default".</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>dry_run</code></td>
            <td>
                  <code>(bool or int, <span title="typing.Optional">Optional</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Run one training and validation batch
for one epoch to detect any bugs prior to training the full model.
Disables tuners, checkpoint callbacks, loggers, and logger callbacks.
Defaults to False.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>batch_size</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Batch size to use for training. Defaults to 2.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>auto_lr_find</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Use a learning rate finder algorithm when calling
trainer.tune() to try to find an optimal initial learning rate. Defaults to
False. The learning rate finder is not guaranteed to find a good learning
rate; depending on the dataset, it can select a learning rate that leads to
poor model training. Use with caution.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>backbone_finetune_params</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="zamba.models.config.BackboneFinetuneConfig" href="#zamba.models.config.BackboneFinetuneConfig">BackboneFinetuneConfig</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Set parameters
to finetune a backbone model to align with the current learning rate.
Defaults to a BackboneFinetuneConfig(unfreeze_backbone_at_epoch=5,
backbone_initial_ratio_lr=0.01, multiplier=1, pre_train_bn=False,
train_bn=False, verbose=True).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>gpus</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of GPUs to train on applied per node.
Defaults to all of the available GPUs found on the machine.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>num_workers</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of subprocesses to use for data loading. 0 means
that the data will be loaded in the main process. The maximum value is
the number of CPUs in the system. Defaults to 3.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>max_epochs</code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Stop training once this number of epochs is
reached. Disabled by default (None), which stops training at 1000 epochs.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>early_stopping_config</code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="zamba.models.config.EarlyStoppingConfig" href="#zamba.models.config.EarlyStoppingConfig">EarlyStoppingConfig</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configuration for
early stopping, which monitors a metric during training and stops training
when the metric stops improving. Defaults to EarlyStoppingConfig(monitor='val_macro_f1',
patience=5, verbose=True, mode='max').</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>weight_download_region</code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>s3 region to download pretrained weights from.
Options are "us" (United States), "eu" (Europe), or "asia" (Asia Pacific).
Defaults to "us".</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>split_proportions</code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Proportions used to divide data into training,
validation, and holdout sets if a if a "split" column is not included in
labels. Defaults to "train": 3, "val": 1, "holdout": 1.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>save_dir</code></td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to a directory where training files
will be saved. Files include the best model checkpoint (<code>model_name</code>.ckpt),
training configuration (configuration.yaml), Tensorboard logs
(events.out.tfevents...), test metrics (test_metrics.json), validation
metrics (val_metrics.json), and model hyperparameters (hparams.yml).
If None, a folder is created in the working directory. Defaults to None.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>overwrite</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If True, will save outputs in <code>save_dir</code> overwriting if those
exist. If False, will create auto-incremented <code>version_n</code> folder in <code>save_dir</code>
with model outputs. Defaults to False.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>from_scratch</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Instantiate the model with base weights. This means
starting with ImageNet weights for image-based models (time_distributed,
european, and blank_nonblank) and Kinetics weights for video-based models
(slowfast). Defaults to False.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>use_default_model_labels</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>By default, output the full set of
default model labels rather than just the species in the labels file. Only
applies if the provided labels are a subset of the default model labels.
If set to False, will replace the model head for finetuning and output only
the species in the provided labels file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>model_cache_dir</code></td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Cache directory where downloaded model weights
will be saved. If None and the MODEL_CACHE_DIR environment variable is
not set, uses your default cache directory. Defaults to None.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

              <details class="quote">
                <summary>Source code in <code>zamba/models/config.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">TrainConfig</span><span class="p">(</span><span class="n">ZambaBaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Configuration for training a model.</span>

<span class="sd">    Args:</span>
<span class="sd">        labels (FilePath or pandas DataFrame): Path to a CSV or pandas DataFrame</span>
<span class="sd">            containing labels for training, with one row per label. There must be</span>
<span class="sd">            columns called &#39;filepath&#39; (absolute or relative to the data_dir) and</span>
<span class="sd">            &#39;label&#39;, and optionally columns called &#39;split&#39; (&quot;train&quot;, &quot;val&quot;, or &quot;holdout&quot;)</span>
<span class="sd">            and &#39;site&#39;. Labels must be specified to train a model.</span>
<span class="sd">        data_dir (DirectoryPath): Path to a directory containing training</span>
<span class="sd">            videos. Defaults to the working directory.</span>
<span class="sd">        model_name (str, optional): Name of the model to use for training. Options are:</span>
<span class="sd">            time_distributed, slowfast, european, blank_nonblank. Defaults to time_distributed.</span>
<span class="sd">        checkpoint (FilePath, optional): Path to a custom checkpoint file (.ckpt)</span>
<span class="sd">            generated by zamba that can be used to resume training. If None, defaults</span>
<span class="sd">            to a pretrained model. Defaults to None.</span>
<span class="sd">        scheduler_config (SchedulerConfig or str, optional): Config for setting up</span>
<span class="sd">            the learning rate scheduler on the model. If &quot;default&quot;, uses scheduler</span>
<span class="sd">            that was used for training. If None, will not use a scheduler.</span>
<span class="sd">            Defaults to &quot;default&quot;.</span>
<span class="sd">        dry_run (bool or int, Optional): Run one training and validation batch</span>
<span class="sd">            for one epoch to detect any bugs prior to training the full model.</span>
<span class="sd">            Disables tuners, checkpoint callbacks, loggers, and logger callbacks.</span>
<span class="sd">            Defaults to False.</span>
<span class="sd">        batch_size (int): Batch size to use for training. Defaults to 2.</span>
<span class="sd">        auto_lr_find (bool): Use a learning rate finder algorithm when calling</span>
<span class="sd">            trainer.tune() to try to find an optimal initial learning rate. Defaults to</span>
<span class="sd">            False. The learning rate finder is not guaranteed to find a good learning</span>
<span class="sd">            rate; depending on the dataset, it can select a learning rate that leads to</span>
<span class="sd">            poor model training. Use with caution.</span>
<span class="sd">        backbone_finetune_params (BackboneFinetuneConfig, optional): Set parameters</span>
<span class="sd">            to finetune a backbone model to align with the current learning rate.</span>
<span class="sd">            Defaults to a BackboneFinetuneConfig(unfreeze_backbone_at_epoch=5,</span>
<span class="sd">            backbone_initial_ratio_lr=0.01, multiplier=1, pre_train_bn=False,</span>
<span class="sd">            train_bn=False, verbose=True).</span>
<span class="sd">        gpus (int): Number of GPUs to train on applied per node.</span>
<span class="sd">            Defaults to all of the available GPUs found on the machine.</span>
<span class="sd">        num_workers (int): Number of subprocesses to use for data loading. 0 means</span>
<span class="sd">            that the data will be loaded in the main process. The maximum value is</span>
<span class="sd">           the number of CPUs in the system. Defaults to 3.</span>
<span class="sd">        max_epochs (int, optional): Stop training once this number of epochs is</span>
<span class="sd">            reached. Disabled by default (None), which stops training at 1000 epochs.</span>
<span class="sd">        early_stopping_config (EarlyStoppingConfig, optional): Configuration for</span>
<span class="sd">            early stopping, which monitors a metric during training and stops training</span>
<span class="sd">            when the metric stops improving. Defaults to EarlyStoppingConfig(monitor=&#39;val_macro_f1&#39;,</span>
<span class="sd">            patience=5, verbose=True, mode=&#39;max&#39;).</span>
<span class="sd">        weight_download_region (str): s3 region to download pretrained weights from.</span>
<span class="sd">            Options are &quot;us&quot; (United States), &quot;eu&quot; (Europe), or &quot;asia&quot; (Asia Pacific).</span>
<span class="sd">            Defaults to &quot;us&quot;.</span>
<span class="sd">        split_proportions (dict): Proportions used to divide data into training,</span>
<span class="sd">            validation, and holdout sets if a if a &quot;split&quot; column is not included in</span>
<span class="sd">            labels. Defaults to &quot;train&quot;: 3, &quot;val&quot;: 1, &quot;holdout&quot;: 1.</span>
<span class="sd">        save_dir (Path, optional): Path to a directory where training files</span>
<span class="sd">            will be saved. Files include the best model checkpoint (``model_name``.ckpt),</span>
<span class="sd">            training configuration (configuration.yaml), Tensorboard logs</span>
<span class="sd">            (events.out.tfevents...), test metrics (test_metrics.json), validation</span>
<span class="sd">            metrics (val_metrics.json), and model hyperparameters (hparams.yml).</span>
<span class="sd">            If None, a folder is created in the working directory. Defaults to None.</span>
<span class="sd">        overwrite (bool): If True, will save outputs in `save_dir` overwriting if those</span>
<span class="sd">            exist. If False, will create auto-incremented `version_n` folder in `save_dir`</span>
<span class="sd">            with model outputs. Defaults to False.</span>
<span class="sd">        skip_load_validation (bool). Skip ffprobe check, which verifies that all</span>
<span class="sd">            videos can be loaded and skips files that cannot be loaded. Defaults</span>
<span class="sd">            to False.</span>
<span class="sd">        from_scratch (bool): Instantiate the model with base weights. This means</span>
<span class="sd">            starting with ImageNet weights for image-based models (time_distributed,</span>
<span class="sd">            european, and blank_nonblank) and Kinetics weights for video-based models</span>
<span class="sd">            (slowfast). Defaults to False.</span>
<span class="sd">        use_default_model_labels (bool, optional): By default, output the full set of</span>
<span class="sd">            default model labels rather than just the species in the labels file. Only</span>
<span class="sd">            applies if the provided labels are a subset of the default model labels.</span>
<span class="sd">            If set to False, will replace the model head for finetuning and output only</span>
<span class="sd">            the species in the provided labels file.</span>
<span class="sd">        model_cache_dir (Path, optional): Cache directory where downloaded model weights</span>
<span class="sd">            will be saved. If None and the MODEL_CACHE_DIR environment variable is</span>
<span class="sd">            not set, uses your default cache directory. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">labels</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">FilePath</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span>
    <span class="n">data_dir</span><span class="p">:</span> <span class="n">DirectoryPath</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">checkpoint</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FilePath</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">scheduler_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">SchedulerConfig</span><span class="p">]]</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>
    <span class="n">model_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ModelEnum</span><span class="p">]</span> <span class="o">=</span> <span class="n">ModelEnum</span><span class="o">.</span><span class="n">time_distributed</span><span class="o">.</span><span class="n">value</span>
    <span class="n">dry_run</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">auto_lr_find</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">backbone_finetune_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BackboneFinetuneConfig</span><span class="p">]</span> <span class="o">=</span> <span class="n">BackboneFinetuneConfig</span><span class="p">()</span>
    <span class="n">gpus</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">GPUS_AVAILABLE</span>
    <span class="n">num_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">max_epochs</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">early_stopping_config</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EarlyStoppingConfig</span><span class="p">]</span> <span class="o">=</span> <span class="n">EarlyStoppingConfig</span><span class="p">()</span>
    <span class="n">weight_download_region</span><span class="p">:</span> <span class="n">RegionEnum</span> <span class="o">=</span> <span class="s2">&quot;us&quot;</span>
    <span class="n">split_proportions</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;train&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;val&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;holdout&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
    <span class="n">save_dir</span><span class="p">:</span> <span class="n">Path</span> <span class="o">=</span> <span class="n">Path</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span>
    <span class="n">overwrite</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">skip_load_validation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">from_scratch</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">use_default_model_labels</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">model_cache_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
        <span class="n">arbitrary_types_allowed</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">_validate_gpus</span> <span class="o">=</span> <span class="n">validator</span><span class="p">(</span><span class="s2">&quot;gpus&quot;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">validate_gpus</span><span class="p">)</span>

    <span class="n">_validate_model_cache_dir</span> <span class="o">=</span> <span class="n">validator</span><span class="p">(</span><span class="s2">&quot;model_cache_dir&quot;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span>
        <span class="n">validate_model_cache_dir</span>
    <span class="p">)</span>

    <span class="nd">@root_validator</span><span class="p">(</span><span class="n">skip_on_failure</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">validate_from_scratch_and_checkpoint</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;from_scratch&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;checkpoint&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If from_scratch=True, you cannot specify a checkpoint.&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;model_name&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;If from_scratch=True, model_name cannot be None.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">values</span>

    <span class="n">_validate_model_name_and_checkpoint</span> <span class="o">=</span> <span class="n">root_validator</span><span class="p">(</span><span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skip_on_failure</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span>
        <span class="n">validate_model_name_and_checkpoint</span>
    <span class="p">)</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;scheduler_config&quot;</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">validate_scheduler_config</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">scheduler_config</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">scheduler_config</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">SchedulerConfig</span><span class="p">(</span><span class="n">scheduler</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">scheduler_config</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">and</span> <span class="n">scheduler_config</span> <span class="o">!=</span> <span class="s2">&quot;default&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Scheduler can either be &#39;default&#39;, None, or a SchedulerConfig.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">scheduler_config</span>

    <span class="nd">@root_validator</span><span class="p">(</span><span class="n">skip_on_failure</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">turn_off_load_validation_if_dry_run</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;dry_run&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;skip_load_validation&quot;</span><span class="p">]:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Turning off video loading check since dry_run=True.&quot;</span><span class="p">)</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;skip_load_validation&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">values</span>

    <span class="nd">@root_validator</span><span class="p">(</span><span class="n">skip_on_failure</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">validate_filepaths_and_labels</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Validating labels csv.&quot;</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">],</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
            <span class="k">else</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="s2">&quot;filepath&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">columns</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> must contain `filepath` and `label` columns.&quot;</span><span class="p">)</span>

        <span class="c1"># subset to required and optional</span>
        <span class="n">cols_to_keep</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">labels</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;filepath&quot;</span><span class="p">,</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span> <span class="s2">&quot;site&quot;</span><span class="p">,</span> <span class="s2">&quot;split&quot;</span><span class="p">]]</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">cols_to_keep</span><span class="p">]</span>

        <span class="c1"># validate split column has no partial nulls or invalid values</span>
        <span class="k">if</span> <span class="s2">&quot;split&quot;</span> <span class="ow">in</span> <span class="n">labels</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="c1"># if split is entirely null, warn, drop column, and generate splits automatically</span>
            <span class="k">if</span> <span class="n">labels</span><span class="o">.</span><span class="n">split</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Split column is entirely null. Will generate splits automatically using `split_proportions`.&quot;</span>
                <span class="p">)</span>
                <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;split&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># error if split column has null values</span>
            <span class="k">elif</span> <span class="n">labels</span><span class="o">.</span><span class="n">split</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="n">labels</span><span class="o">.</span><span class="n">split</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2"> row(s) with null `split`. Fill in these rows with either `train`, `val`, or `holdout`. Alternatively, do not include a `split` column in your labels and we&#39;ll generate splits for you using `split_proportions`.&quot;</span>
                <span class="p">)</span>

            <span class="c1"># otherwise check that split values are valid</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="nb">set</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">split</span><span class="p">)</span><span class="o">.</span><span class="n">issubset</span><span class="p">({</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="s2">&quot;val&quot;</span><span class="p">,</span> <span class="s2">&quot;holdout&quot;</span><span class="p">}):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Found the following invalid values for `split`: </span><span class="si">{</span><span class="nb">set</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">split</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">({</span><span class="s1">&#39;train&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;val&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;holdout&#39;</span><span class="p">})</span><span class="si">}</span><span class="s2">. `split` can only contain `train`, `val`, or `holdout.`&quot;</span>
                <span class="p">)</span>

            <span class="k">elif</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;split_proportions&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Labels contains split column yet split_proportions are also provided. Split column in labels takes precedence.&quot;</span>
                <span class="p">)</span>
                <span class="c1"># set to None for clarity in final configuration.yaml</span>
                <span class="n">values</span><span class="p">[</span><span class="s2">&quot;split_proportions&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># error if labels are entirely null</span>
        <span class="n">null_labels</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">null_labels</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Species cannot be null for all videos.&quot;</span><span class="p">)</span>

        <span class="c1"># skip and warn about any videos without species label</span>
        <span class="k">elif</span> <span class="nb">sum</span><span class="p">(</span><span class="n">null_labels</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">null_labels</span><span class="p">)</span><span class="si">}</span><span class="s2"> filepath(s) with no label. Will skip.&quot;</span><span class="p">)</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="o">~</span><span class="n">null_labels</span><span class="p">]</span>

        <span class="c1"># check that all videos exist and can be loaded</span>
        <span class="n">values</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">check_files_exist_and_load</span><span class="p">(</span>
            <span class="n">df</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
            <span class="n">data_dir</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;data_dir&quot;</span><span class="p">],</span>
            <span class="n">skip_load_validation</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;skip_load_validation&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">values</span>

    <span class="nd">@root_validator</span><span class="p">(</span><span class="n">skip_on_failure</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">validate_provided_species_and_use_default_model_labels</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;If the model species are the desired output, the labels file must contain</span>
<span class="sd">        a subset of the model species.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">provided_species</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
        <span class="n">model_species</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
            <span class="n">get_model_species</span><span class="p">(</span><span class="n">checkpoint</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;checkpoint&quot;</span><span class="p">],</span> <span class="n">model_name</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;model_name&quot;</span><span class="p">])</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">provided_species</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">model_species</span><span class="p">):</span>
            <span class="c1"># if labels are not a subset, user cannot set use_default_model_labels to True</span>
            <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;use_default_model_labels&quot;</span><span class="p">]:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Conflicting information between `use_default_model_labels=True` and the &quot;</span>
                    <span class="s2">&quot;species provided in labels file. &quot;</span>
                    <span class="s2">&quot;If you want your model to predict all the zamba species, make sure your &quot;</span>
                    <span class="s2">&quot;labels are a subset. The species in the labels file that are not &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;in the model species are </span><span class="si">{</span><span class="n">provided_species</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">model_species</span><span class="si">}</span><span class="s2">. &quot;</span>
                    <span class="s2">&quot;If you want your model to only predict the species in your labels file, &quot;</span>
                    <span class="s2">&quot;set `use_default_model_labels` to False.&quot;</span>
                <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">values</span><span class="p">[</span><span class="s2">&quot;use_default_model_labels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># if labels are a subset, default to True if no value provided</span>
        <span class="k">elif</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;use_default_model_labels&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;use_default_model_labels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="n">values</span>

    <span class="nd">@root_validator</span><span class="p">(</span><span class="n">skip_on_failure</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">preprocess_labels</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;One hot encode, add splits, and check for binary case.</span>

<span class="sd">        Replaces values[&#39;labels&#39;] with modified DataFrame.</span>

<span class="sd">        Args:</span>
<span class="sd">            values: dictionary containing &#39;labels&#39; and other config info</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Preprocessing labels into one hot encoded labels with one row per video.&quot;</span><span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span>

        <span class="c1"># lowercase to facilitate subset checking</span>
        <span class="n">labels</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

        <span class="n">model_species</span> <span class="o">=</span> <span class="n">get_model_species</span><span class="p">(</span>
            <span class="n">checkpoint</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;checkpoint&quot;</span><span class="p">],</span> <span class="n">model_name</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;model_name&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">labels</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">categories</span><span class="o">=</span><span class="n">model_species</span> <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;use_default_model_labels&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="c1"># one hot encode collapse to one row per video</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;species&quot;</span><span class="p">}),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;species&quot;</span><span class="p">])</span>
            <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;filepath&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="p">)</span>

        <span class="c1"># if no &quot;split&quot; column, set up train, val, and holdout split</span>
        <span class="k">if</span> <span class="s2">&quot;split&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">labels</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">make_split</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>

        <span class="c1"># if there are only two species columns and every video belongs to one of them,</span>
        <span class="c1"># keep only blank label if it exists to allow resuming of blank_nonblank model</span>
        <span class="c1"># otherwise drop the second species column so the problem is treated as a binary classification</span>
        <span class="n">species_cols</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s2">&quot;species_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span>
        <span class="n">sums</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">species_cols</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">species_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="p">(</span><span class="n">sums</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="n">col_to_keep</span> <span class="o">=</span> <span class="s2">&quot;species_blank&quot;</span> <span class="k">if</span> <span class="s2">&quot;species_blank&quot;</span> <span class="ow">in</span> <span class="n">species_cols</span> <span class="k">else</span> <span class="n">species_cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">col_to_drop</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">species_cols</span> <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="n">col_to_keep</span><span class="p">]</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Binary case detected so only one species column will be kept. Output will be the binary case of </span><span class="si">{</span><span class="n">col_to_keep</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">col_to_drop</span><span class="p">)</span>

        <span class="c1"># filepath becomes column instead of index</span>
        <span class="n">values</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">values</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="zamba.models.config.TrainConfig.preprocess_labels" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">preprocess_labels</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

<a href="#zamba.models.config.TrainConfig.preprocess_labels" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>One hot encode, add splits, and check for binary case.</p>
<p>Replaces values['labels'] with modified DataFrame.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>values</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary containing 'labels' and other config info</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>zamba/models/config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@root_validator</span><span class="p">(</span><span class="n">skip_on_failure</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">preprocess_labels</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;One hot encode, add splits, and check for binary case.</span>

<span class="sd">    Replaces values[&#39;labels&#39;] with modified DataFrame.</span>

<span class="sd">    Args:</span>
<span class="sd">        values: dictionary containing &#39;labels&#39; and other config info</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Preprocessing labels into one hot encoded labels with one row per video.&quot;</span><span class="p">)</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span>

    <span class="c1"># lowercase to facilitate subset checking</span>
    <span class="n">labels</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="n">model_species</span> <span class="o">=</span> <span class="n">get_model_species</span><span class="p">(</span>
        <span class="n">checkpoint</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;checkpoint&quot;</span><span class="p">],</span> <span class="n">model_name</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;model_name&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">labels</span><span class="p">[</span><span class="s2">&quot;label&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">categories</span><span class="o">=</span><span class="n">model_species</span> <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;use_default_model_labels&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>
    <span class="c1"># one hot encode collapse to one row per video</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">labels</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;species&quot;</span><span class="p">}),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;species&quot;</span><span class="p">])</span>
        <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;filepath&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="c1"># if no &quot;split&quot; column, set up train, val, and holdout split</span>
    <span class="k">if</span> <span class="s2">&quot;split&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">labels</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">make_split</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span>

    <span class="c1"># if there are only two species columns and every video belongs to one of them,</span>
    <span class="c1"># keep only blank label if it exists to allow resuming of blank_nonblank model</span>
    <span class="c1"># otherwise drop the second species column so the problem is treated as a binary classification</span>
    <span class="n">species_cols</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s2">&quot;species_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span>
    <span class="n">sums</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">species_cols</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">species_cols</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="p">(</span><span class="n">sums</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="n">col_to_keep</span> <span class="o">=</span> <span class="s2">&quot;species_blank&quot;</span> <span class="k">if</span> <span class="s2">&quot;species_blank&quot;</span> <span class="ow">in</span> <span class="n">species_cols</span> <span class="k">else</span> <span class="n">species_cols</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">col_to_drop</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">species_cols</span> <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="n">col_to_keep</span><span class="p">]</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Binary case detected so only one species column will be kept. Output will be the binary case of </span><span class="si">{</span><span class="n">col_to_keep</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">col_to_drop</span><span class="p">)</span>

    <span class="c1"># filepath becomes column instead of index</span>
    <span class="n">values</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">values</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="zamba.models.config.TrainConfig.validate_provided_species_and_use_default_model_labels" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_provided_species_and_use_default_model_labels</span><span class="p">(</span><span class="n">values</span><span class="p">)</span></code>

<a href="#zamba.models.config.TrainConfig.validate_provided_species_and_use_default_model_labels" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>If the model species are the desired output, the labels file must contain
a subset of the model species.</p>

            <details class="quote">
              <summary>Source code in <code>zamba/models/config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@root_validator</span><span class="p">(</span><span class="n">skip_on_failure</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">validate_provided_species_and_use_default_model_labels</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;If the model species are the desired output, the labels file must contain</span>
<span class="sd">    a subset of the model species.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">provided_species</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;labels&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
    <span class="n">model_species</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
        <span class="n">get_model_species</span><span class="p">(</span><span class="n">checkpoint</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;checkpoint&quot;</span><span class="p">],</span> <span class="n">model_name</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;model_name&quot;</span><span class="p">])</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">provided_species</span><span class="o">.</span><span class="n">issubset</span><span class="p">(</span><span class="n">model_species</span><span class="p">):</span>
        <span class="c1"># if labels are not a subset, user cannot set use_default_model_labels to True</span>
        <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;use_default_model_labels&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Conflicting information between `use_default_model_labels=True` and the &quot;</span>
                <span class="s2">&quot;species provided in labels file. &quot;</span>
                <span class="s2">&quot;If you want your model to predict all the zamba species, make sure your &quot;</span>
                <span class="s2">&quot;labels are a subset. The species in the labels file that are not &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;in the model species are </span><span class="si">{</span><span class="n">provided_species</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">model_species</span><span class="si">}</span><span class="s2">. &quot;</span>
                <span class="s2">&quot;If you want your model to only predict the species in your labels file, &quot;</span>
                <span class="s2">&quot;set `use_default_model_labels` to False.&quot;</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;use_default_model_labels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># if labels are a subset, default to True if no value provided</span>
    <span class="k">elif</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;use_default_model_labels&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">values</span><span class="p">[</span><span class="s2">&quot;use_default_model_labels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">values</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="zamba.models.config.ZambaBaseModel" class="doc doc-heading">
            <code>ZambaBaseModel</code>


<a href="#zamba.models.config.ZambaBaseModel" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="pydantic.BaseModel">BaseModel</span></code></p>


        <p>Set defaults for all models that inherit from the pydantic base model.</p>

              <details class="quote">
                <summary>Source code in <code>zamba/models/config.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ZambaBaseModel</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set defaults for all models that inherit from the pydantic base model.&quot;&quot;&quot;</span>

    <span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
        <span class="n">extra</span> <span class="o">=</span> <span class="s2">&quot;forbid&quot;</span>
        <span class="n">use_enum_values</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">validate_assignment</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">











  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="zamba.models.config.check_files_exist_and_load" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">check_files_exist_and_load</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">,</span> <span class="n">skip_load_validation</span><span class="p">)</span></code>

<a href="#zamba.models.config.check_files_exist_and_load" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Check whether files in file list exist and can be loaded with ffmpeg.
Warn and skip files that don't exist or can't be loaded.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>df</code></td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame with a "filepath" column</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>data_dir</code></td>
            <td>
                  <code><span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Data folder to prepend if filepath is not an
absolute path.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>skip_load_validation</code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Skip ffprobe check that verifies all videos
can be loaded.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd.DataFrame: DataFrame with valid and loadable videos.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>zamba/models/config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">check_files_exist_and_load</span><span class="p">(</span>
    <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">:</span> <span class="n">DirectoryPath</span><span class="p">,</span> <span class="n">skip_load_validation</span><span class="p">:</span> <span class="nb">bool</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check whether files in file list exist and can be loaded with ffmpeg.</span>
<span class="sd">    Warn and skip files that don&#39;t exist or can&#39;t be loaded.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pd.DataFrame): DataFrame with a &quot;filepath&quot; column</span>
<span class="sd">        data_dir (Path): Data folder to prepend if filepath is not an</span>
<span class="sd">            absolute path.</span>
<span class="sd">        skip_load_validation (bool): Skip ffprobe check that verifies all videos</span>
<span class="sd">            can be loaded.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: DataFrame with valid and loadable videos.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># update filepath column to prepend data_dir</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;filepath&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">data_dir</span><span class="p">)</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">filepath</span><span class="o">.</span><span class="n">path</span>

    <span class="c1"># we can have multiple rows per file with labels so limit just to one row per file for these checks</span>
    <span class="n">files_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s2">&quot;filepath&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>

    <span class="c1"># check for missing files</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Checking all </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files_df</span><span class="p">)</span><span class="si">:</span><span class="s2">,</span><span class="si">}</span><span class="s2"> filepaths exist. Trying fast file checking...&quot;</span><span class="p">)</span>

    <span class="c1"># try to check files in parallel</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="n">files_df</span><span class="p">[</span><span class="s2">&quot;filepath&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">Path</span><span class="p">)</span>
    <span class="n">exists</span> <span class="o">=</span> <span class="n">pqdm</span><span class="p">(</span><span class="n">paths</span><span class="p">,</span> <span class="n">Path</span><span class="o">.</span><span class="n">exists</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">exists</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">exists</span><span class="p">)</span>

    <span class="c1"># if fast checking fails, fall back to slow checking</span>
    <span class="c1"># if an I/O error is in `exists`, the array has dtype `object`</span>
    <span class="k">if</span> <span class="n">exists</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Fast file checking failed. Running slower check, which can take 30 seconds per thousand files.&quot;</span>
        <span class="p">)</span>
        <span class="n">exists</span> <span class="o">=</span> <span class="n">files_df</span><span class="p">[</span><span class="s2">&quot;filepath&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span>

    <span class="c1"># select the missing files</span>
    <span class="n">invalid_files</span> <span class="o">=</span> <span class="n">files_df</span><span class="p">[</span><span class="o">~</span><span class="n">exists</span><span class="p">]</span>

    <span class="c1"># if no files exist</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">invalid_files</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">files_df</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;None of the video filepaths exist. Are you sure they&#39;re specified correctly? Here&#39;s an example invalid path: </span><span class="si">{</span><span class="n">invalid_files</span><span class="o">.</span><span class="n">filepath</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">. Either specify absolute filepaths in the csv or provide filepaths relative to `data_dir`.&quot;</span>
        <span class="p">)</span>

    <span class="c1"># if at least some files exist</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">invalid_files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The following files could not be found: </span><span class="si">{</span><span class="s1">&#39;/n&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">invalid_files</span><span class="o">.</span><span class="n">filepath</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Skipping </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">invalid_files</span><span class="p">)</span><span class="si">}</span><span class="s2"> file(s) that could not be found. For example, </span><span class="si">{</span><span class="n">invalid_files</span><span class="o">.</span><span class="n">filepath</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">)</span>
        <span class="c1"># remove invalid files to prep for ffprobe check on remaining</span>
        <span class="n">files_df</span> <span class="o">=</span> <span class="n">files_df</span><span class="p">[</span><span class="o">~</span><span class="n">files_df</span><span class="o">.</span><span class="n">filepath</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">invalid_files</span><span class="o">.</span><span class="n">filepath</span><span class="p">)]</span>

    <span class="n">bad_load</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">skip_load_validation</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;Checking that all videos can be loaded. If you&#39;re very confident all your videos can be loaded, you can skip this with `skip_load_validation`, but it&#39;s not recommended.&quot;</span>
        <span class="p">)</span>

        <span class="c1"># ffprobe check</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">files_df</span><span class="o">.</span><span class="n">filepath</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ffmpeg</span><span class="o">.</span><span class="n">probe</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
            <span class="k">except</span> <span class="n">ffmpeg</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">ZambaFfmpegException</span><span class="p">(</span><span class="n">exc</span><span class="o">.</span><span class="n">stderr</span><span class="p">))</span>
                <span class="n">bad_load</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">bad_load</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Skipping </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">bad_load</span><span class="p">)</span><span class="si">}</span><span class="s2"> file(s) that could not be loaded with ffmpeg.&quot;</span>
            <span class="p">)</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span>
        <span class="p">(</span><span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">filepath</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">bad_load</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">df</span><span class="o">.</span><span class="n">filepath</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">invalid_files</span><span class="o">.</span><span class="n">filepath</span><span class="p">))</span>
    <span class="p">]</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="zamba.models.config.get_filepaths" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_filepaths</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#zamba.models.config.get_filepaths" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>If no file list is passed, get all files in data directory. Warn if there
are unsupported suffixes. Filepaths is set to a dataframe, where column <code>filepath</code>
contains files with valid suffixes.</p>

            <details class="quote">
              <summary>Source code in <code>zamba/models/config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_filepaths</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;If no file list is passed, get all files in data directory. Warn if there</span>
<span class="sd">    are unsupported suffixes. Filepaths is set to a dataframe, where column `filepath`</span>
<span class="sd">    contains files with valid suffixes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;filepaths&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Getting files in </span><span class="si">{</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;data_dir&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">new_suffixes</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># iterate over all files in data directory</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;data_dir&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">is_file</span><span class="p">():</span>
                <span class="c1"># keep just files with supported suffixes</span>
                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">VIDEO_SUFFIXES</span><span class="p">:</span>
                    <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>
                <span class="k">elif</span> <span class="n">PREDICT_ON_IMAGES</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">IMAGE_SUFFIXES</span><span class="p">:</span>
                    <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">resolve</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">new_suffixes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">suffix</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">new_suffixes</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Ignoring </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">new_suffixes</span><span class="p">)</span><span class="si">}</span><span class="s2"> file(s) with suffixes </span><span class="si">{</span><span class="nb">set</span><span class="p">(</span><span class="n">new_suffixes</span><span class="p">)</span><span class="si">}</span><span class="s2">. To include, specify all video suffixes with a VIDEO_SUFFIXES environment variable.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No video files found in </span><span class="si">{</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;data_dir&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span><span class="si">}</span><span class="s2"> videos in </span><span class="si">{</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;data_dir&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="n">values</span><span class="p">[</span><span class="s2">&quot;filepaths&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;filepath&quot;</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">values</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="zamba.models.config.make_split" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_split</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#zamba.models.config.make_split" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Add a split column to <code>labels</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code>labels</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame with one row per video</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code>values</code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary with config info</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>zamba/models/config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_split</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Add a split column to `labels`.</span>

<span class="sd">    Args:</span>
<span class="sd">        labels: DataFrame with one row per video</span>
<span class="sd">        values: dictionary with config info</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Dividing videos into train, val, and holdout sets using the following split proportions: </span><span class="si">{</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;split_proportions&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span>
    <span class="p">)</span>

    <span class="c1"># use site info if we have it</span>
    <span class="k">if</span> <span class="s2">&quot;site&quot;</span> <span class="ow">in</span> <span class="n">labels</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using provided &#39;site&#39; column to do a site-specific split&quot;</span><span class="p">)</span>
        <span class="n">labels</span><span class="p">[</span><span class="s2">&quot;split&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">create_site_specific_splits</span><span class="p">(</span>
            <span class="n">labels</span><span class="p">[</span><span class="s2">&quot;site&quot;</span><span class="p">],</span> <span class="n">proportions</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;split_proportions&quot;</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># otherwise randomly allocate</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="s2">&quot;No &#39;site&#39; column found so videos for each species will be randomly allocated across splits using provided split proportions.&quot;</span>
        <span class="p">)</span>

        <span class="n">expected_splits</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;split_proportions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">SPLIT_SEED</span><span class="p">)</span>

        <span class="c1"># check we have at least as many videos per species as we have splits</span>
        <span class="c1"># labels are OHE at this point</span>
        <span class="n">num_videos_per_species</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s2">&quot;species_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="n">too_few</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;species_&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">v</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">num_videos_per_species</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">v</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">expected_splits</span><span class="p">)</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">too_few</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Not all species have enough videos to allocate into the following splits: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">expected_splits</span><span class="p">)</span><span class="si">}</span><span class="s2">. A minimum of </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">expected_splits</span><span class="p">)</span><span class="si">}</span><span class="s2"> videos per label is required. Found the following counts: </span><span class="si">{</span><span class="n">too_few</span><span class="si">}</span><span class="s2">. Either remove these labels or add more videos.&quot;</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">labels</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s2">&quot;species_&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">species_df</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">species_df</span><span class="p">):</span>
                <span class="c1"># within each species, seed splits by putting one video in each set and then allocate videos based on split proportions</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">species_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s2">&quot;split&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">expected_splits</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span>
                    <span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;split_proportions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                    <span class="n">weights</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;split_proportions&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
                    <span class="n">k</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">species_df</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">expected_splits</span><span class="p">),</span>
                <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">labels</span><span class="o">.</span><span class="n">split</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># write splits.csv</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;save_dir&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="s2">&quot;splits.csv&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Writing out split information to </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="c1"># create the directory to save if we need to</span>
    <span class="n">values</span><span class="p">[</span><span class="s2">&quot;save_dir&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">labels</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[[</span><span class="s2">&quot;filepath&quot;</span><span class="p">,</span> <span class="s2">&quot;split&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="zamba.models.config.validate_gpus" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_gpus</span><span class="p">(</span><span class="n">gpus</span><span class="p">)</span></code>

<a href="#zamba.models.config.validate_gpus" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Ensure the number of GPUs requested is equal to or less than the number of GPUs
available on the machine.</p>

            <details class="quote">
              <summary>Source code in <code>zamba/models/config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_gpus</span><span class="p">(</span><span class="n">gpus</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Ensure the number of GPUs requested is equal to or less than the number of GPUs</span>
<span class="sd">    available on the machine.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">gpus</span> <span class="o">&gt;</span> <span class="n">GPUS_AVAILABLE</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Found only </span><span class="si">{</span><span class="n">GPUS_AVAILABLE</span><span class="si">}</span><span class="s2"> GPU(s). Cannot use </span><span class="si">{</span><span class="n">gpus</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">gpus</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="zamba.models.config.validate_model_cache_dir" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_model_cache_dir</span><span class="p">(</span><span class="n">model_cache_dir</span><span class="p">)</span></code>

<a href="#zamba.models.config.validate_model_cache_dir" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Set up cache directory for downloading model weight. Order of priority is:
config argument, environment variable, or user's default cache dir.</p>

            <details class="quote">
              <summary>Source code in <code>zamba/models/config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_model_cache_dir</span><span class="p">(</span><span class="n">model_cache_dir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Path</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set up cache directory for downloading model weight. Order of priority is:</span>
<span class="sd">    config argument, environment variable, or user&#39;s default cache dir.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">model_cache_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">model_cache_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;MODEL_CACHE_DIR&quot;</span><span class="p">,</span> <span class="n">Path</span><span class="p">(</span><span class="n">appdirs</span><span class="o">.</span><span class="n">user_cache_dir</span><span class="p">())</span> <span class="o">/</span> <span class="s2">&quot;zamba&quot;</span><span class="p">)</span>

    <span class="n">model_cache_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">model_cache_dir</span><span class="p">)</span>
    <span class="n">model_cache_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model_cache_dir</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="zamba.models.config.validate_model_name_and_checkpoint" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_model_name_and_checkpoint</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">)</span></code>

<a href="#zamba.models.config.validate_model_name_and_checkpoint" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Ensures a checkpoint file or model name is provided. If a model name is provided,
looks up the corresponding public checkpoint file from the official configs.
Download the checkpoint if it does not yet exist.</p>

            <details class="quote">
              <summary>Source code in <code>zamba/models/config.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">validate_model_name_and_checkpoint</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Ensures a checkpoint file or model name is provided. If a model name is provided,</span>
<span class="sd">    looks up the corresponding public checkpoint file from the official configs.</span>
<span class="sd">    Download the checkpoint if it does not yet exist.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">checkpoint</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;checkpoint&quot;</span><span class="p">)</span>
    <span class="n">model_name</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;model_name&quot;</span><span class="p">)</span>

    <span class="c1"># must specify either checkpoint or model name</span>
    <span class="k">if</span> <span class="n">checkpoint</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">model_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must provide either model_name or checkpoint path.&quot;</span><span class="p">)</span>

    <span class="c1"># checkpoint supercedes model</span>
    <span class="k">elif</span> <span class="n">checkpoint</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">model_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Using checkpoint file: </span><span class="si">{</span><span class="n">checkpoint</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="c1"># get model name from checkpoint so it can be used for the video loader config</span>
        <span class="n">hparams</span> <span class="o">=</span> <span class="n">get_checkpoint_hparams</span><span class="p">(</span><span class="n">checkpoint</span><span class="p">)</span>
        <span class="n">values</span><span class="p">[</span><span class="s2">&quot;model_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">available_models</span><span class="p">[</span><span class="n">hparams</span><span class="p">[</span><span class="s2">&quot;model_class&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">_default_model_name</span>

    <span class="k">elif</span> <span class="n">checkpoint</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">model_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;from_scratch&quot;</span><span class="p">):</span>
            <span class="c1"># get public weights file from official models config</span>
            <span class="n">values</span><span class="p">[</span><span class="s2">&quot;checkpoint&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">get_model_checkpoint_filename</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>

            <span class="c1"># if cached version exists, use that</span>
            <span class="n">cached_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;model_cache_dir&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;checkpoint&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">cached_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">values</span><span class="p">[</span><span class="s2">&quot;checkpoint&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cached_path</span>

            <span class="c1"># download if checkpoint doesn&#39;t exist</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;checkpoint&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloading weights for model to </span><span class="si">{</span><span class="n">values</span><span class="p">[</span><span class="s1">&#39;model_cache_dir&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
                <span class="n">values</span><span class="p">[</span><span class="s2">&quot;checkpoint&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">download_weights</span><span class="p">(</span>
                    <span class="n">filename</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;checkpoint&quot;</span><span class="p">]),</span>
                    <span class="n">weight_region</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;weight_download_region&quot;</span><span class="p">],</span>
                    <span class="n">destination_dir</span><span class="o">=</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;model_cache_dir&quot;</span><span class="p">],</span>
                <span class="p">)</span>

    <span class="k">return</span> <span class="n">values</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.indexes", "navigation.sections"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.d6f25eb3.min.js"></script>
      
    
  </body>
</html>